# 线下作业

## 线下作业内容

主要就是实现一个中间件的服务程序，主要就是有面向web端的一个客户端，承接web端发送过来的post请求，还有就是面向andoroid端的一个服务端，主要就是通过web端的请求，向相应的android发送相应的文件，并且可以向多个android同时发送数据，并且可以实现一定的暂定功能。


## 实现方法

### 对要求中的一些细节进行假设

1. 对于web端，定义为C这边时客服端，但是主要还是web端来发送post请求，相应的post请求格式见附录。
2. C服务器这端主要就是实现通过web端的post请求表单，得到需要发送的设备id以及需要发送的歌曲列表,其中包括音乐的介绍，标题，歌手，id。
3. 对歌曲的查找这里是通过对文件名格式为“id_标题_歌手”，用于通过id、标题、歌手对相应的文件进行查找。
4. android端需要先对c服务器这端进行连接，并且上线之后才能进行其他操作。
5. android端在上线状态下，在60s内不对c服务器端发送消息时,c服务器这端会自动的将该android端断开，并清除与其相关的文件传输。
6. android端在文件传输状态下可以不发送心跳包，也可以发送。
7. android端在发送下线响应时，c服务器这端会保留该android的数据60s，60s之后会自动断开连接，并清除相应的数据。
8. 在向android端发送消息时，android端发送过来一个异常停止消息时，这边会保存当前发送状态60s，在60s内，android端请求再次发送时，可以需要之前中断的发送。

### 实现的功能

#### 面向web端

1. c服务器实现了通过web端的url或者ip地址与端口号对web端的连接。
2. 可以轮循的轮循监听web端的post请求。
3. 可以通过web端发送过来的请求进行判断，判断其是否是c服务器这端支持的post请求,发送过来的数据茶长度是否与请求头上的长度一致，其中的起要发送的文件是否是该c服务器中有的。
4. 可以支持对请求中发送设备的id向android端打包，发送给不同的设备。
5. 可以根据请求的情况,向web端返回状态码，其中主要就包括3中的情况。

#### 面向android端
1. 实现了对信道的实时监听，可以与多设备建立连接
2. 可以同时实现对多设备的消息监听功能，可以实时的对其中的响应更新响应的设备数据
3. 实现了一定的自动断开的功能。
4. 可以实时的对web端发过来的需要向指定设备发送数据的请求作出响应。
5. 可以实时的对多设备进行发送消息，并且可以实时的实现一定时间的暂定功能。

## 附录

POST /test HTTP/1.1
Host: foo.example
Content-Type: application/x-www-form-urlencoded
Content-Length: ??

id=4&name=sugar&title=sugar&status=0&updateTime=2021-6-7%2011:1:44&deviceID=3&deviceName=XIAOMI?id=4&name=aaaaa&title=aaaaa&status=0&updateTime=2021-6-7%2011:2:45&deviceID=3&deviceName=XIAOMI?

